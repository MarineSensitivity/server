# production Caddyfile for BOEM internal server
# subdirectory routing on :80 (no TLS — no public DNS for ACME)
# hostname: ioemazeudmar01.mms.doi.net

(cors) {
	@origin header Origin *
	header @origin {
		Access-Control-Allow-Origin  "*"
		Access-Control-Request-Method GET
	}
}

:80 {
	# shiny apps — strip /app prefix, proxy to shiny container
	handle_path /app/* {
		reverse_proxy shiny:3838
	}

	# public file server — strip /file prefix, browse /share/public
	handle_path /file/* {
		import cors
		root * /share/public
		file_server browse {
			precompressed zstd br gzip
		}
	}

	# project documentation — serve static html from /share/public/www
	handle /docs/* {
		root * /share/public/www
		file_server
	}

	# homepage — default handler
	handle {
		root * /share/public/www
		file_server
	}
}
